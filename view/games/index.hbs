{{#> main title=title}}

<div class="max-w-7xl mx-auto">
  
  <div class="bg-gray-800 p-6 rounded-2xl shadow-lg mb-8">
    <h2 class="text-2xl font-bold text-white mb-4">Import Game</h2>
    <p class="text-gray-400 mb-4">Nh·∫≠p t√™n game, h·ªá th·ªëng s·∫Ω t·ª± ƒë·ªông t√¨m, c√†o d·ªØ li·ªáu v√† import v√†o danh s√°ch.</p>
    
    <form id="search-form">
      <div class="flex flex-col md:flex-row gap-4">
        <input name="query" placeholder="Nh·∫≠p t√™n game (v√≠ d·ª•: Cyberpunk 2077)" required 
               class="flex-grow bg-gray-700 text-white border border-gray-600 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500"/>
        
        <button type="submit" id="search-button"
                class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold px-6 py-2 rounded-lg transition-colors duration-200
                       disabled:bg-gray-500 disabled:cursor-not-allowed">
          T√¨m & Import
        </button>
      </div>
    </form>
    <div id="search-results" class="mt-4 text-sm"></div>
  </div>

  <h1 class="text-3xl font-bold text-white mb-6">üéÆ Danh s√°ch Game c·ªßa b·∫°n</h1>

  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    {{#each games}}
      {{> gameCard game=this idx=@index}}
      {{else}}
      <p class="text-gray-400 col-span-3">Ch∆∞a c√≥ game n√†o trong danh s√°ch. H√£y t√¨m ki·∫øm game tr∆∞·ªõc ti√™n theo nhu c·∫ßu c·ªßa b·∫°n nh√©!</p>
    {{/each}}
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const searchForm = document.getElementById('search-form');
    const searchBtn = document.getElementById('search-button');
    const resultDiv = document.getElementById('search-results');

    if(searchForm){
      searchForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        searchBtn.textContent = 'ƒêang t√¨m...';

        const formData = new FormData(searchForm);
        const query = formData.get('query');
        if(!query) return;

        searchBtn.disabled = true;
        resultDiv.textContent = 'ƒêang t√¨m ...';
        resultDiv.innerHTML = `
          <p class="text-yellow-400">
            üîç ƒêang t√¨m game c√≥ t√™n "<strong>${query}</strong>"...
            Vui l√≤ng ƒë·ªçi 1 ch√∫tv√† kh√¥ng t·∫Øt tr√¨nh duy·ªát nh√©! Qu√° tr√¨nh n√†y c√≥ th·ªÉ k√©o d√†i v√†i ph√∫t.
            </p>`;

        try{
          // G·ªçi API
          const response = await fetch('/games/search', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({ query })
          });
          const data = await response.json();

          if(!data || data.error){
            resultDiv.innerHTML = `
              <p class="text-red-400">‚ùå Kh√¥ng th√†nh c√¥ng: <strong>${data.detail || data.error}</strong></>p`;
          } else {
            resultDiv.innerHTML = `
            <div class="bg-gray-700 p-4 rounded-lg">
              <p class="text-green-400">‚úÖ ƒê√£ t√¨m v√† import th√†nh c√¥ng v√†o danh s√°ch!</p>
              <p class="text-gray-400 mt-3">
                <a href="/games" class="text-indigo-400 font-bold hover:underline">B·∫•m v√†o ƒë√¢y</a>
                ƒë·ªÉ xem danh s√°ch c·∫≠p nh·∫≠t
              </p>
            </div>`;
          }
        } catch(error){
          resultDiv.innerHTML = `
            <p class="text-red-400">‚ùå C√≥ l·ªói x·∫£y ra: ${error.message}!!!
                      Kh√¥ng th·ªÉ k·∫øt n·ªëi t·ªõi server</p>`;
        } finally{
          searchBtn.disabled = false;
          searchBtn.textContent = 'T√¨m & Import';
        }
      });
    }
  })
  const cards = document.querySelectorAll('.game-card-item');
  cards.forEach(card => {
      card.classList.remove('opacity-0', 'translate-y-4');
      card.classList.add('opacity-100', 'translate-y-0');
  });
</script>

{{/main}}